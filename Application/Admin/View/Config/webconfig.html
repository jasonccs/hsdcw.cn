<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>网站配置</title>
    <link rel="shortcut icon" href="__PUBLIC__/img/favicon.ico">
    <link href="__PUBLIC__/css/bootstrap.min14ed.css" rel="stylesheet">
    <link href="__PUBLIC__/css/font-awesome.min93e3.css" rel="stylesheet">
    <link href="__PUBLIC__/css/plugins/iCheck/custom.css" rel="stylesheet">

    <!-- Data Tables -->
    <link href="__PUBLIC__/css/plugins/dataTables/dataTables.bootstrap.css" rel="stylesheet">
    <link href="__PUBLIC__/css/animate.min.css" rel="stylesheet">
    <link href="__PUBLIC__/css/style.css" rel="stylesheet">

    <!-- Sweet Alert -->
    <link href="__PUBLIC__/css/plugins/sweetalert/sweetalert.css" rel="stylesheet">
    <link href="__PUBLIC__/css/animate.min.css" rel="stylesheet">

    <script src="__PUBLIC__/js/jquery-1.10.2.min.js"></script>

    <script src="__ROOT__/Public/Static/uploadify/jquery.uploadify.min.js" type="text/javascript"></script>
    <link rel="stylesheet" type="text/css" href="__ROOT__/Public/Static/uploadify/uploadify.css">
</head>


<body class="gray-bg">
<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="col-sm-12">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5>系统设置</h5>
                    <div class="ibox-tools">
                        <a class="collapse-link">
                            <i class="fa fa-chevron-up"></i>
                        </a>
                    </div>
                </div>
                <div class="ibox-content">
                    <form action="{:U('Admin/Config/updateconfig')}" class="form-horizontal m-t" id="signupForm" method="post" enctype="multipart/form-data">

                        <table class="table table-striped table-bordered table-hover dataTables-example">
                            <tbody>

                            <input type="hidden" name="id" value="{$config.id}"/>

                            <tr class="gradeA col-md  ">
                                <td>网站名称：</td>
                                <td class="form-group"><input type="text" id="webname" name="webname" class="form-control m-input" placeholder="网站名称" value="{$config.webname}" required="" aria-required="true" minlength="2" maxlength="80" ></td>

                            </tr>

                            <tr class="gradeA col-md  ">
                                <td>站点默认关键字：</td>
                                <td class="form-group"><input type="text" id="keywords" name="keywords" class="form-control m-input" placeholder="网站关键字" value="{$config.keywords}" required="" aria-required="true" minlength="2" maxlength="80" ></td>

                            </tr>

                            <tr class="gradeX col-md">
                                <td>站点描述(100字内)</td>
                                <td class="form-group"><textarea type="text" name="description" class="form-control m-input" placeholder="请站点描述"  minlength="2" maxlength="120"  required="" aria-required="true"style="resize:none;">{$config.description}</textarea></td>

                            </tr>

                            <tr class="gradeA col-md  ">
                                <td>网站备案号：</td>
                                <td class="form-group"><input type="text" id="beian" name="beian" class="form-control m-input" placeholder="网站备案号" value="{$config.beian}" required="" aria-required="true" minlength="2" maxlength="20" ></td>

                            </tr>

                            <tr class="gradeA col-md  ">
                                <td>手机号：</td>
                                <td class="form-group"><input type="number" id="phone" name="phone" class="form-control m-input" placeholder="网站手机号" value="{$config.phone}" required="" aria-required="true" minlength="2" maxlength="11" ></td>

                            </tr>
                            <tr class="gradeA col-md  ">
                                <td>email：</td>
                                <td class="form-group"><input type="text" id="email" name="email" class="form-control m-input" placeholder="email" value="{$config.email}" required="" aria-required="true" minlength="2" maxlength="30" ></td>

                            </tr>
                            <tr class="gradeA col-md  ">
                                <td>业务email：</td>
                                <td class="form-group"><input type="text" id="ywemail" name="ywemail" class="form-control m-input" placeholder="业务email" value="{$config.ywemail}" required="" aria-required="true" minlength="2" maxlength="30" ></td>

                            </tr>
                            <tr class="gradeA col-md  ">
                                <td>微信公众号</td>
                                <td class="form-group"><input type="text" id="weixin" name="weixin" class="form-control m-input" placeholder="微信公众号" value="{$config.weixin}" required="" aria-required="true" minlength="2" maxlength="30" ></td>

                            </tr>

                            <tr class="gradeA col-md  ">
                                <td>公司地址：</td>
                                <td class="form-group"><input type="text" id="address" name="address" class="form-control m-input" placeholder="公司地址" value="{$config.address}" required="" aria-required="true" minlength="2" maxlength="80" ></td>

                            </tr>
                            <tr class="gradeA col-md  ">
                                <td>QQ号：</td>
                                <td class="form-group"><input type="number" id="qq" name="qq" class="form-control m-input" placeholder="QQ号" value="{$config.qq}" required="" aria-required="true" minlength="2" maxlength="11" ></td>

                            </tr>



                            <tr class="gradeA col-md ">
                                <td>网站logo</td>
                                <td>
                                    <div>
                                        <input id="file" type="file" multiple="true"  value="" >
                                        <div id="allimages" style="display:none">

                                            <if condition="!empty($config['logo'])">

                                                <input type="text" name="desc_image" class="hd-w200 ipt3" required="" aria-required="true" value="{$config.logo}">

                                                <else/>
                                                <!-- <input type="text" name="desc_image" class="hd-w200 ipt3" value=""> -->
                                            </if>

                                        </div>
                                        <span class="miaoshu">类型: *.jpg, *.jpeg,*.png,*gif 大小: 3MB 数量: 1张</span>
                                        <script type="text/javascript">

                                            $(function() {

                                                $('#file').uploadify({
                                                    //POST数据
                                                    'formData'     : {'<?php echo session_name();?>' : '<?php echo session_id();?>'},
                                                    'fileTypeDesc' : '上传文件',//上传描述
                                                    'fileTypeExts' : '*.gif; *.jpg; *.png;*.jpeg;*.bmp',
                                                    'swf'      : '__ROOT__/Public/Static/uploadify/uploadify.swf',
                                                    'uploader' : "{:U('Admin/News/uploadImage')}",
                                                    'method' : 'POST',  //方法，服务端可以用$_POST数组获取数据
                                                    'buttonText':'选择文件',
                                                    'fileSizeLimit' : '3145728KB',
                                                    'multi'         : true,//允许多文件上传
                                                    'uploadLimit' : 4,//上传文件数
                                                    'width':65,
                                                    'height':25,
                                                    'successTimeout':15,//等待服务器响应时间
                                                    'removeTimeout' : 0.5,//成功显示时间 onUploadError
                                                    'overrideEvents' : [ 'onDialogClose','onUploadError', 'onSelectError' ],
                                                    //检测FLASH失败调用
                                                    'onFallback':function(){
                                                        alert("您未安装FLASH控件，无法上传图片！请安装FLASH控件后再试。");
                                                    },

                                                    'onUploadSuccess' : function(file, data, response) {
                                                        data=$.parseJSON(data);
                                                        var imageUrl = data.imgPath?data.imgPath:'__ROOT__/Public/Static/uploadify/default.png';
                                                        var li="<li path='"+data.imgPath+"' ><img src='"+imageUrl+"' class='hd-w120 hd-h100'/></li>";

                                                        $("#uploadList ul").prepend(li);

                                                        var images='<input type="text"  name="desc_image" class="hd-w200 ipt3" value="'+data.imgPath+'"'+'/>';
                                                        // if($("#allimages ul li").length>this.settings.uploadLimit){alert(0); return;}
                                                        $("#allimages").prepend(images);


                                                    },
                                                    // 返回一个错误，选择文件的时候触发
                                                    'onSelectError':function(file, errorCode, errorMsg){
                                                        switch(errorCode) {
                                                            case -100:
                                                                alert("上传的文件数量已经超出系统限制的"+$('#file').uploadify('settings','uploadLimit')+"个文件！");
                                                                break;
                                                            case -110:
                                                                alert("文件 ["+file.name+"] 大小超出系统限制的"+$('#file').uploadify('settings','fileSizeLimit')+"大小！");
                                                                break;
                                                            case -120:
                                                                alert("文件 ["+file.name+"] 大小异常！");
                                                                break;
                                                            case -130:
                                                                alert("文件 ["+file.name+"] 类型不正确！");
                                                                break;
                                                        }
                                                    },
                                                    'onUploadError':function(file, errorCode, errorMsg) {
                                                        //手工取消不弹出提示
                                                        if (errorCode == SWFUpload.UPLOAD_ERROR.FILE_CANCELLED  || errorCode == SWFUpload.UPLOAD_ERROR.UPLOAD_STOPPED) {
                                                            return;
                                                        }
                                                        var msgText = "上传失败";
                                                        switch (errorCode) {
                                                            case SWFUpload.UPLOAD_ERROR.HTTP_ERROR:
                                                                msgText += "HTTP 错误\n" + errorMsg;
                                                                break;
                                                            case SWFUpload.UPLOAD_ERROR.MISSING_UPLOAD_URL:
                                                                msgText += "上传文件丢失，请重新上传";
                                                                break;
                                                            case SWFUpload.UPLOAD_ERROR.IO_ERROR:
                                                                msgText += "IO错误";
                                                                break;
                                                            case SWFUpload.UPLOAD_ERROR.SECURITY_ERROR:
                                                                msgText += "安全性错误\n" + errorMsg;
                                                                break;
                                                            case SWFUpload.UPLOAD_ERROR.UPLOAD_LIMIT_EXCEEDED:
                                                                msgText += "每次最多上传 " + this.settings.uploadLimit + "个";
                                                                break;
                                                            case SWFUpload.UPLOAD_ERROR.UPLOAD_FAILED:
                                                                msgText += errorMsg;
                                                                break;
                                                            case SWFUpload.UPLOAD_ERROR.SPECIFIED_FILE_ID_NOT_FOUND:
                                                                msgText += "找不到指定文件，请重新操作";
                                                                break;
                                                            case SWFUpload.UPLOAD_ERROR.FILE_VALIDATION_FAILED:
                                                                msgText += "参数错误";
                                                                break;
                                                            default:
                                                                msgText += "文件:" + file.name + "\n错误码:" + errorCode + "\n"
                                                                    + errorMsg + "\n" + errorString;
                                                        }
                                                        alert(msgText);
                                                    } ,


                                                });
                                            });
                                        </script>

                                        <div id="uploadList">
                                            <ul>
                                                <if condition="!empty($config['logo'])">

                                                    <li path="{$config.logo}" ><img src="{$config.logo}" class="hd-w120 hd-h100"></li>
                                                    <else/>
                                                    <!-- <li path="{$config.logo}" ><img src="{$config.logo}" class="hd-w120 hd-h100"></li>  -->
                                                </if>
                                            </ul>
                                        </div>

                                </td>
                            </tr>
                            <script type="text/javascript">
                                $(function(){
                                    $('#uploadList>ul').on('click','li',function(){

                                        var imgpath    = $(this).attr('path');
                                        var index      = $(this).index();//点击的索引
                                        $.ajax({
                                            type:"post",
                                            url:"{:U('Admin/Common/delImg')}",
                                            dataType: "json",
                                            data:{delimgpath:imgpath},
                                            success:function(data){
                                                if(data.status==true){

                                                    $("#uploadList>ul>li:eq("+index+")").remove();
                                                    $("#allimages>input:eq("+index+")").remove();
                                                    swal({title:"太帅了",text:"已删除",type:"success"})

                                                }
                                            }
                                        })
                                    });
                                })
                            </script>


                            </tbody>
                            <tfoot>
                            <tr >
                                <th colspan="2">
                                    <button class="btn btn-sm btn-primary pull-center" type="submit" style="margin-left: 50%;">
                                        <i class="fa fa-check"></i> <strong>确定</strong>
                                    </button>
                                </th>


                            </tr>
                            </tfoot>

                        </table>
                    </form>
                </div>
            </div>
        </div>
    </div>

</div>
<script src="__PUBLIC__/js/bootstrap.min.js"></script>
<script src="__PUBLIC__/js/plugins/jeditable/jquery.jeditable.js"></script>
<script src="__PUBLIC__/js/plugins/dataTables/jquery.dataTables.js"></script>
<script src="__PUBLIC__/js/plugins/dataTables/dataTables.bootstrap.js"></script>
<script src="__PUBLIC__/js/content.min.js"></script>
<script src="__PUBLIC__/js/plugins/iCheck/icheck.min.js"></script>
<script>
    $(document).ready(function(){$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green",radioClass:"iradio_square-green",})});
</script>
<script src="__PUBLIC__/js/plugins/layer/laydate/laydate.js"></script>

<script src="__PUBLIC__/js/plugins/validate/jquery.validate.min.js"></script>
<script src="__PUBLIC__/js/plugins/validate/messages_zh.min.js"></script>
<script src="__PUBLIC__/js/demo/form-validate-demo.min.js"></script>

<!--sweetalert-->
<script src="__PUBLIC__/js/plugins/sweetalert/sweetalert.min.js"></script>
</body>
</html>
